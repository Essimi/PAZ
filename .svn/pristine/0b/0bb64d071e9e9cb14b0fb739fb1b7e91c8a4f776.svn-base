package kr.or.ddit.common.authentication.controller;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import javax.inject.Inject;

import org.springframework.stereotype.Controller;

import kr.or.ddit.project.service.ProjectService;
import lombok.extern.slf4j.Slf4j;

@Controller
@Slf4j
public class ProjectStatusChange {
	
	@Inject
	private ProjectService service;
	
	public void projectStatusChangeMet(){
		
		log.info("=======================================================================================================");
		log.info("=======================================================================================================");
		log.info("=======================================================================================================");
		log.info("=========================================PROJECT STATUS CHANGE=========================================");
		log.info("=======================================================================================================");
		log.info("=======================================================================================================");
		log.info("=======================================================================================================");
		
		String pCode = null;
	
		// 오늘 날짜와 프로젝트 시작 날짜가 같은 데이터들만 출력합니다.
		List<Map<Object, String>> pro = service.projectStartDate();
				
		// 데이터 입력을 위해 리스트 객체를 생성해줍니다.
		List<String> changeList = new ArrayList<String>();
		
		if(pro.size() > 0) {
			// 반복문을 돌며 프로젝트 코드만 출력합니다.
			for(Map<Object, String> data : pro) {
				pCode = data.get("P_CODE");
				changeList.add(pCode);
			}
			
			// 프로젝트 상태를 변경합니다.		
		 	service.updateForProjectStart(changeList);		
		}
		
		log.info("========================================================================================================");
		log.info("========================================================================================================");
		log.info("========================================================================================================");
		log.info("=============================================Scheduling END=============================================");
		log.info("========================================================================================================");
		log.info("========================================================================================================");
		log.info("========================================================================================================");
		
	}
}
